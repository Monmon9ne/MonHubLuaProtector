<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mon Lua Protector - RAW Creator</title>
<style>
    body {
        background: #0a0a0a;
        color: #00eaff;
        font-family: Consolas, monospace;
        padding: 20px;
    }
    input, textarea {
        width: 100%;
        background: #111;
        border: 1px solid #00eaff;
        padding: 10px;
        color: #00eaff;
        margin-top: 10px;
    }
    button {
        background: #00eaff;
        border: none;
        padding: 10px 20px;
        color: #000;
        cursor: pointer;
        font-weight: bold;
        margin-top: 10px;
    }
</style>
</head>
<body>

<h1>Mon Lua Protector - RAW Creator</h1>

<input type="file" id="fileInput">
<textarea id="codeInput" placeholder="Paste Lua code here..."></textarea>
<input type="password" id="passwordInput" placeholder="Enter password">

<button onclick="createRAW()">Create RAW</button>

<h3>Output</h3>
<input id="rawLink" readonly>
<button onclick="copy('rawLink')">Copy Link</button>

<input id="loadstringLink" readonly>
<button onclick="copy('loadstringLink')">Copy Loadstring</button>

<script>
async function loadFile(file) {
    return await file.text();
}

document.getElementById("fileInput").addEventListener("change", async (e) => {
    let file = e.target.files[0];
    if (file) {
        document.getElementById("codeInput").value = await loadFile(file);
    }
});

function encrypt(text, password) {
    return btoa(unescape(encodeURIComponent(text + "::" + password)));
}

async function createRAW() {
    const code = document.getElementById("codeInput").value.trim();
    const pass = document.getElementById("passwordInput").value.trim();

    if (!code || !pass) return alert("Missing code or password");

    const encrypted = encrypt(code, pass);

    // load local DB
    let db = await fetch("raw-db.json").then(r => r.json()).catch(() => ({ raws: [] }));

    let id = "raw_" + Date.now();

    db.raws.push({
        id: id,
        encrypted: encrypted
    });

    // save to localStorage (vì GitHub không cho ghi file)
    localStorage.setItem("mon_raw_db", JSON.stringify(db));

    let link = location.origin + "/raw-creator/raw.html?id=" + id;

    document.getElementById("rawLink").value = link;

    document.getElementById("loadstringLink").value =
        `loadstring(game:HttpGet("${link}"))()`;

    alert("RAW created. Push local JSON to GitHub manually.");
}

function copy(id) {
    let x = document.getElementById(id);
    x.select();
    navigator.clipboard.writeText(x.value);
}
</script>

</body>
</html>
